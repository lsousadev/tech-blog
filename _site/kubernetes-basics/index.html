<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="google-translate-customization" content="108d9124921d80c3-80e20d618ff053c8-g4f02ec6f3dba68b7-c">
<!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Kubernetes Basics | Tech Notebook by Lucas</title>
<meta name="generator" content="Jekyll v4.2.1">
<meta property="og:title" content="Kubernetes Basics">
<meta name="author" content="Lucas">
<meta property="og:locale" content="en_US">
<meta name="description" content="This blog was created for note-keeping purposes, not educational. Browse at your own peril.">
<meta property="og:description" content="This blog was created for note-keeping purposes, not educational. Browse at your own peril.">
<link rel="canonical" href="http://localhost:4000/kubernetes-basics/">
<meta property="og:url" content="http://localhost:4000/kubernetes-basics/">
<meta property="og:site_name" content="Tech Notebook by Lucas">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2021-12-18T00:00:00-08:00">
<meta name="twitter:card" content="summary">
<meta property="twitter:title" content="Kubernetes Basics">
<script type="application/ld+json">
{"@type":"BlogPosting","url":"http://localhost:4000/kubernetes-basics/","headline":"Kubernetes Basics","dateModified":"2021-12-18T00:00:00-08:00","datePublished":"2021-12-18T00:00:00-08:00","author":{"@type":"Person","name":"Lucas"},"mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/kubernetes-basics/"},"description":"This blog was created for note-keeping purposes, not educational. Browse at your own peril.","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="shortcut icon" href="/assets/images/devops.png">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-noto-sans@0.0.72/index.min.css">
  <link rel="stylesheet" href="/assets/css/main.css">
  <script src="/assets/js/main.js"></script><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Tech Notebook by Lucas">
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/default.min.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js"></script>
<!-- and it's easy to individually load additional languages -->
<script charset="UTF-8" src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/languages/go.min.js"></script>



















<script>
// Init highlight js
document.addEventListener('DOMContentLoaded', function(event) {
  var els = document.querySelectorAll('pre code')

  function addLangData(block) {
    var outer = block.parentElement.parentElement.parentElement;
    var lang = block.getAttribute('data-lang');
    for (var i = 0; i < outer.classList.length; i++) {
      var cls = outer.classList[i];
      if (cls.startsWith('language-')) {
        lang = cls;
        break;
      }
    }
    if (!lang) {
      cls = block.getAttribute('class');
      lang = cls ? cls.replace('hljs ', '') : '';
    }
    if (lang.startsWith('language-')) {
      lang = lang.substr(9);
    }
    block.setAttribute('class', 'hljs ' + lang);
    block.parentNode.setAttribute('data-lang', lang);
  }

  function addBadge(block) {
    var enabled = ('true' || 'true').toLowerCase();
    if (enabled == 'true') {
      var pre = block.parentElement;
      pre.classList.add('badge');
    }
  }

  function handle(block) {
    addLangData(block);
    addBadge(block)
    hljs.highlightBlock(block);
  }

  for (var i = 0; i < els.length; i++) {
    var el = els[i];
    handle(el);
  }
});
</script>

<style>
  /* code language badge */
  pre.badge::before {
    content: attr(data-lang);
    color: #fff;
    background-color: #ff4e00;
    padding: 0 .5em;
    border-radius: 0 2px;
    text-transform: uppercase;
    text-align: center;
    min-width: 32px;
    display: inline-block;
    position: absolute;
    right: 0;
  }

  /* fix wrong badge display for firefox browser */
  code > table pre::before {
    display: none;
  }
</style>
</head>
<body>



























































































































<header class="site-header " role="banner">

  <div class="wrapper">
    <div class="site-header-inner">
<span class="site-brand"><a class="site-brand-inner" rel="author" href="/">
  <img class="site-favicon" title="Tech Notebook by Lucas" src="/assets/images/devops.png" onerror="this.style.display='none'">
  Tech Notebook by Lucas
</a>
</span><nav class="site-nav">
          <input type="checkbox" id="nav-trigger" class="nav-trigger">
          <label for="nav-trigger">
            <span class="menu-icon">
              <svg viewbox="0 0 18 15" width="18px" height="15px">
                <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"></path>
              </svg>
            </span>
          </label>

          <div class="trigger">
<a class="page-link" href="/">HOME</a><a class="page-link" href="/archives/">ARCHIVES</a><a class="page-link" href="/categories/">CATEGORIES</a><a class="page-link" href="/tags/">TAGS</a><a class="page-link" href="/about/">ABOUT</a>









<span class="page-link">



<div id="google_translate_element" style="display: none;">
</div>

<span class="ct-language">
  <ul class="list-unstyled ct-language-dropdown">
    
      <li>
        <a href="#" class="lang-select" data-lang="en">
          
          <img src="https://cdn.countryflags.com/thumbs/united-states-of-america/flag-400.png" title="English">
          
        </a>
      </li>
    
      <li>
        <a href="#" class="lang-select" data-lang="fr">
          
          <img src="https://cdn.countryflags.com/thumbs/france/flag-400.png" title="French">
          
        </a>
      </li>
    
      <li>
        <a href="#" class="lang-select" data-lang="zh-CN">
          
          <img src="https://cdn.countryflags.com/thumbs/china/flag-400.png" title="Chinese(Simple)">
          
        </a>
      </li>
    
      <li>
        <a href="#" class="lang-select" data-lang="ja">
          
          <img src="https://cdn.countryflags.com/thumbs/japan/flag-400.png" title="Japanese">
          
        </a>
      </li>
    
      <li>
        <a href="#" class="lang-select" data-lang="ko">
          
          <img src="https://cdn.countryflags.com/thumbs/south-korea/flag-400.png" title="Korean">
          
        </a>
      </li>
    
      <li>
        <a href="#" class="lang-select" data-lang="ru">
          
          <img src="https://cdn.countryflags.com/thumbs/russia/flag-400.png" title="Russian">
          
        </a>
      </li>
    
  </ul>
</span>

<script type="text/javascript">
function googleTranslateElementInit() {
  new google.translate.TranslateElement({
    pageLanguage: 'en',
    autoDisplay: false,
    layout: google.translate.TranslateElement.InlineLayout.VERTICAL
  }, 'google_translate_element');

  // Links to cross-origin destinations are unsafe
  var gll = document.getElementsByClassName('goog-logo-link')[0];
  if (gll) {
    gll.setAttribute('rel', 'noopener');
  }

  function restoreLang() {
    var iframe = document.getElementsByClassName('goog-te-banner-frame')[0];
    if (!iframe) return;

    var innerDoc = iframe.contentDocument || iframe.contentWindow.document;
    var restore_el = innerDoc.getElementsByTagName("button");

    for (var i = 0; i < restore_el.length; i++) {
      if (restore_el[i].id.indexOf("restore") >= 0) {
        restore_el[i].click();
        var close_el = innerDoc.getElementsByClassName("goog-close-link");
        close_el[0].click();
        return;
      }
    }
  }

  function triggerHtmlEvent(element, eventName) {
    var event;
    if (document.createEvent) {
      event = document.createEvent('HTMLEvents');
      event.initEvent(eventName, true, true);
      element.dispatchEvent(event);
    } else {
      event = document.createEventObject();
      event.eventType = eventName;
      element.fireEvent('on' + event.eventType, event);
    }
  }

  var googleCombo = document.querySelector("select.goog-te-combo");
  var langSelect = document.querySelector('.ct-language');
  langSelect.addEventListener('click', function(event) {
    if (!event.target) {
      return;
    }

    var selected = document.querySelector('.ct-language .ct-language-selected');
    if (selected) {
      selected.classList.remove('ct-language-selected');
    }

    var target = event.target;
    while (target && target !== langSelect ) {
      if (target.matches('.lang-select')) {
        break;
      }
      target = target.parentElement;
    }

    if (target && target.matches('.lang-select')) {
      var lang = target.getAttribute('data-lang');
      if (googleCombo.value == lang) {
        restoreLang();
      } else {
        target.parentElement.classList.add('ct-language-selected');
        googleCombo.value = lang;
        triggerHtmlEvent(googleCombo, 'change');
      }
    }

    event.preventDefault();
  });
}
</script>

<script type="text/javascript" src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>
</span>
</div>
        </nav>
</div>
  </div>
</header>

<script>
  function initHeader() {
    var lastScrollY = getScrollPos().y;
    var documentElement = document.documentElement;

    function storeScrollData() {
      var y = getScrollPos().y;var scrollStatus = "";

      if (y <= 0) {
        scrollStatus = "top";
      } else if ((window.innerHeight + y) >= document.body.offsetHeight) {
        scrollStatus = "bottom";
      } else {
        var isScrollDown = (y - lastScrollY > 0) ? true : false;
        scrollStatus = isScrollDown ? "down" : "up";
      }

      lastScrollY = y;
      documentElement.setAttribute("data-scroll-status", scrollStatus);
    }

    window.addEventListener('scroll', function(e) {
      storeScrollData();
    });

    storeScrollData();
  }
  document.addEventListener('DOMContentLoaded', initHeader);
</script>
















































































































































<script>
  function hashLocate(hashValue) {
    hashValue = hashValue.replace(/^.*#h-/, '');
    hashValue = decodeURIComponent(hashValue);
    var element = document.getElementById(hashValue);

    if (!element) {
      return;
    }

    var header = document.querySelector('header.site-header');
    var headerRect = header.getBoundingClientRect();
    var headerTop = Math.floor(headerRect.top);
    var headerHeight = Math.floor(headerRect.height);
    var scrollPos = getScrollPos();
    var offsetY = element.offsetTop - (headerTop + headerHeight + 20);

    if (offsetY == scrollPos.y) {
      return;
    }

    if (headerTop == 0  && offsetY > scrollPos.y) {
      offsetY += headerHeight + 2;
    } else if (headerTop < 0  && offsetY < scrollPos.y) {
      offsetY -= headerHeight - 2;
    }

    smoothScrollTo(offsetY);
  }

  // The first event occurred
  window.addEventListener('load', function(event) {
    if (window.location.hash) {
      hashLocate(window.location.hash);
    }
  });

  // The first event occurred
  window.addEventListener('click', function(event) {
    if (event.target.tagName.toLowerCase() == 'a') {
      hashLocate(event.target.getAttribute('href'));
    }
  });
</script>
<div class="theme-toggle">
  <input type="checkbox" id="theme-switch">
  <label for="theme-switch">
    <div class="toggle"></div>
    <div class="names">
      <p class="light">Light</p>
      <p class="dark">Dark</p>
    </div>
  </label>
</div>




<script>
  (function() {
    var sw = document.getElementById('theme-switch');
    var html = document.getElementsByTagName('html')[0];
    var nightModeOption = ('on' || 'auto').toLowerCase();
    var storage = nightModeOption === 'manual'
        ? localStorage
        : sessionStorage;
    var themeData = loadThemeData();

    function saveThemeData(data) {
      storage.setItem('theme', JSON.stringify(data));
    }

    function loadThemeData() {
      var data = storage.getItem('theme');
      try {
        data = JSON.parse(data ? data : '');
      } catch(e) {
        data = { nightShift: undefined, autoToggleAt: 0 };
        saveThemeData(data);
      }
      return data;
    }

    function handleThemeToggle(nightShift) {
      themeData.nightShift = nightShift;
      saveThemeData(themeData);
      html.dataset.theme = nightShift ? 'dark' : 'light';
      setTimeout(function() {
        sw.checked = nightShift ? true : false;
      }, 50);
    }

    function autoThemeToggle() {
      // Next time point of theme toggle
      var now = new Date();
      var toggleAt = new Date();
      var hours = now.getHours();
      var nightShift = hours >= 19 || hours <=7;

      if (nightShift) {
        if (hours > 7) {
          toggleAt.setDate(toggleAt.getDate() + 1);
        }
        toggleAt.setHours(7);
      } else {
        toggleAt.setHours(19);
      }

      toggleAt.setMinutes(0);
      toggleAt.setSeconds(0);
      toggleAt.setMilliseconds(0)

      var delay = toggleAt.getTime() - now.getTime();

      // auto toggle theme mode
      setTimeout(function() {
        handleThemeToggle(!nightShift);
      }, delay);

      return {
        nightShift: nightShift,
        toggleAt: toggleAt.getTime()
      };
    }

    // Listen the theme toggle event
    sw.addEventListener('change', function(event) {
      handleThemeToggle(event.target.checked);
    });

    if (nightModeOption == 'auto') {
      var data = autoThemeToggle();

      // Toggle theme by local setting
      if (data.toggleAt > themeData.autoToggleAt) {
        themeData.autoToggleAt = data.toggleAt;
        handleThemeToggle(data.nightShift);
      } else {
        handleThemeToggle(themeData.nightShift);
      }
    } else if (nightModeOption == 'manual') {
      handleThemeToggle(themeData.nightShift);
    } else {
      var nightShift = themeData.nightShift;
      if (nightShift === undefined) {
        nightShift = nightModeOption === 'on';
      }
      handleThemeToggle(nightShift);
    }
  })();
</script>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <div class="framework">
  <section class="main">

     <div class="post">
  <section>









<header class="post-header">
  <h1 class="post-title p-name" itemprop="name headline">Kubernetes Basics</h1>
  <h2 class="post-subtitle">Note Repository</h2>

  <p class="post-meta">
    <time class="dt-published" datetime="2021-12-18T00:00:00-08:00" itemprop="datePublished"><i class="fa fa-calendar"></i> Dec 18, 2021
    </time>

    
    
































    <span class="post-reading-time left-vsplit"><i class="fa fa-clock-o"></i> About 14 mins</span>
  </p>
<div class="post-tags">
<a class="post-tag" href="/tags.html#devops">#devops</a><a class="post-tag" href="/tags.html#kubernetes">#kubernetes</a><a class="post-tag" href="/tags.html#containers">#containers</a>
</div></header>
<article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

    <div class="post-content e-content" itemprop="articleBody">

      <!--🔴 🟠 ⚫ ⚪ 🟣 🟢 🟡 🔵-->

<h2 id="references">References</h2>

<p><a href="https://www.freecodecamp.org/news/the-kubernetes-handbook/#introduction-to-container-orchestration-and-kubernetes">The Kubernetes Handbook</a></p>

<p><a href="https://github.com/fhsinchy/kubernetes-handbook-projects">GitHub - fhsinchy/kubernetes-handbook-projects</a></p>

<h2 id="useful-code-snippets">Useful Code Snippets</h2>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Create 'pod/&lt;pod_name&gt;'</span>
<span class="c"># Run &lt;image_name&gt; inside pod</span>
kubectl run &lt;pod_name&gt; <span class="se">\</span>
<span class="nt">--image</span><span class="o">=</span>&lt;image_name&gt; <span class="se">\</span>
<span class="nt">--port</span><span class="o">=</span>80
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 'ls -la' for k8s</span>
kubectl get pod/service
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Create 'service/&lt;pod_name&gt;'</span>
<span class="c"># Run load balancer as a service</span>
kubectl expose pod &lt;pod_name&gt; <span class="se">\</span>
<span class="nt">--type</span><span class="o">=</span>LoadBalancer <span class="se">\</span>
<span class="nt">--port</span><span class="o">=</span>80
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Delete resource based on type and name</span>
kubectl delete &lt;<span class="nb">type</span><span class="o">&gt;</span> &lt;name&gt;
</code></pre></div></div>

<h2 id="basics">Basics</h2>

<p>🚢 Container orchestration is the process of automating the <code class="language-plaintext highlighter-rouge">deployment</code>, <code class="language-plaintext highlighter-rouge">management</code>, <code class="language-plaintext highlighter-rouge">scaling</code>, and <code class="language-plaintext highlighter-rouge">networking</code> tasks of containers.</p>

<h3 id="architecture">Architecture</h3>

<p><img src="/assets/images/2021-12-18-kubernetes-basics/k8s_architecture.png" alt="Kubernetes Architecture"></p>

<ul>
  <li>
<code class="language-plaintext highlighter-rouge">kubectl</code>: K8s CLI tool to communicate with your cluster via API</li>
  <li>
<code class="language-plaintext highlighter-rouge">node</code>: the machine, virtual or physical, that hosts the pods. Usually refers to worker nodes that run the containerized workloads, but could also refer to control plane nodes (centralized API, cluster management).
    <ul>
      <li>
<code class="language-plaintext highlighter-rouge">kubelet</code>: primary agent in a node, does things such as start pods &amp; containers or register the node with the apiserver. Receives instructions from the control plane, keeps etcd updated</li>
      <li>
<code class="language-plaintext highlighter-rouge">kube-proxy</code>: runs on each node to maintain network rules. Any network request that reaches a service inside the cluster passes through the kube-proxy service</li>
    </ul>
  </li>
  <li>
<code class="language-plaintext highlighter-rouge">control plane</code>: cluster management
    <ul>
      <li>
<code class="language-plaintext highlighter-rouge">etcd</code>: data store that maintains a record of the state of the cluster in a distributed key-value store</li>
      <li>
<code class="language-plaintext highlighter-rouge">kube-scheduler</code>: queries state of the cluster (at etcd) to schedule/assign workloads to worker nodes, making sure no server is overloaded</li>
      <li>
<code class="language-plaintext highlighter-rouge">kube-api-server</code>: gateway to query and interact with cluster. Validates and processes requests delivered using client libraries like kubectl</li>
      <li>
<code class="language-plaintext highlighter-rouge">cloud-controller-manager</code>: interacts with cloud provider’s (GKE, EKS) API. Keeps local and cloud interactions isolated</li>
      <li>
<code class="language-plaintext highlighter-rouge">kube-controller-manager</code>: responsible for controlling the state of the cluster. Implements and tracks the lifecycle of the controllers deployed to the cluster. Main workloads managed by kube-controller-manager:
        <ul>
          <li>
<code class="language-plaintext highlighter-rouge">Deployment</code>: declarative and good for managing stateless apps (pods are interchangeable and replaceable), it matches the current state of your cluster to the desired state mentioned in the Deployment manifest (YAML). e.g. If you create a deployment with 1 replica, it will check that the desired state of ReplicaSet is 1 and current state is 0, so it will create a ReplicaSet, which will further create the pod.</li>
          <li>
<code class="language-plaintext highlighter-rouge">StatefulSet</code>: lets you run 1+ pods that track state in some manner. Helps match pods with persistent volumes.</li>
          <li>
<code class="language-plaintext highlighter-rouge">DaemonSet</code>: ensures that the pod specified via YAML runs on all the nodes of the cluster. If a node is added/removed from a cluster, DaemonSet automatically adds/deletes the pod. e.g. Installing a monitoring agent on each node.</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h3 id="objects">Objects</h3>

<ul>
  <li>
<code class="language-plaintext highlighter-rouge">pods</code>: self-contained, easily replicable objects. Can host a container or a group of (very closely related — more than back-end app + db) containers with shared network IP address and filesystem volumes, meant to run a single instance of an application.</li>
  <li>
<code class="language-plaintext highlighter-rouge">services</code>: since pods are ephemeral (destroyed and replaced, not recycled — new IP every time), a service is an abstraction that groups a logical set of pods and presents them as a single entity, e.g. LoadBalancer, ClusterIP, NodePort, ExternalName
    <ul>
      <li>
<code class="language-plaintext highlighter-rouge">LoadBalancer</code>: exposes a group of pods as one entity to the outside (of the cluster). The pod(s) become(s) exposed on the port specified. Can be accessed via <code class="language-plaintext highlighter-rouge">minikube service &lt;service_name&gt;</code>, which accesses the cluster’s IP + the ephemeral exposed port, which is mapped to the port exposed by the load balancer.</li>
      <li>
<code class="language-plaintext highlighter-rouge">ClusterIP</code>: same as LoadBalancer but only within the cluster</li>
    </ul>
  </li>
  <li>
<code class="language-plaintext highlighter-rouge">Controllers</code>: non-terminating control loops that watch the state of the cluster and make/request changes accordingly. There are controllers to manage each type of workload supported by Kubernetes.</li>
</ul>

<h2 id="declarative-app-example">Declarative App Example</h2>

<h3 id="directory-tree">Directory Tree</h3>

<ul>
  <li>src /
    <ul>
      <li>(app code)</li>
    </ul>
  </li>
  <li>k8s /
    <ul>
      <li>
        <p>example-pod.yaml</p>

        <div class="language-yaml highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span> <span class="c1"># k8s API version</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Pod</span> <span class="c1"># object type</span>
<span class="na">metadata</span><span class="pi">:</span> <span class="c1"># useful for future referencing</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">example-pod</span>
    <span class="na">labels</span><span class="pi">:</span> <span class="c1"># services select objects via labels</span>
    <span class="na">component</span><span class="pi">:</span> <span class="s">web</span>
<span class="na">spec</span><span class="pi">:</span> <span class="c1"># specify state wanted for object</span>
    <span class="na">containers</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">example</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">example/latest</span>
    <span class="na">ports</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">containerPort</span><span class="pi">:</span> <span class="m">80</span>
</code></pre></div>        </div>
      </li>
      <li>
        <p>example-lb-service.yaml</p>

        <div class="language-yaml highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Service</span>
<span class="na">metadata</span><span class="pi">:</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">example-lb-service</span>
<span class="na">spec</span><span class="pi">:</span>
    <span class="na">type</span><span class="pi">:</span> <span class="s">LoadBalancer</span> <span class="c1"># other options: ClusterIP, NodePort, ExternalName</span>
    <span class="na">ports</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">port</span><span class="pi">:</span> <span class="m">80</span> <span class="c1"># port for others to access LB pod</span>
    <span class="na">targetPort</span><span class="pi">:</span> <span class="m">80</span> <span class="c1"># containers' port (must match)</span>
    <span class="na">selector</span><span class="pi">:</span> <span class="c1"># ID objects connected to the service</span>
    <span class="na">component</span><span class="pi">:</span> <span class="s">web</span>
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
  <li>
    <p>Dockerfile</p>

    <div class="language-bash highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="c"># copies the whole directory into node image directory</span>
<span class="c"># installs package.json with npm, then runs build</span>
<span class="c"># copies compiled app into nginx image with port 80 exposed</span>
<span class="c"># after that, image can run as container with port 80 publicly accessible</span>
</code></pre></div>    </div>
  </li>
  <li>index.html</li>
  <li>package.json</li>
</ul>

<h3 id="execution">Execution</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="c"># Both 'apply' commands can be consolidated with 'kubectl apply -f &lt;directory&gt;'</span>

  kubectl apply <span class="nt">-f</span> example-pod.yaml
  
  <span class="c"># pod/example-pod created</span>
  
  kubectl get pod
  
  <span class="c"># NAME         READY   STATUS    RESTARTS   AGE</span>
  <span class="c"># example-pod   1/1     Running   0          3m3s</span>
  
  kubectl apply <span class="nt">-f</span> example-lb-service.yaml
  
  <span class="c"># service/example-lb-service created</span>
  
  kubectl get service
  
  <span class="c"># NAME                 TYPE           CLUSTER-IP       EXTERNAL-IP   PORT(S)        AGE</span>
  <span class="c"># example-lb-service   LoadBalancer   10.107.231.120   &lt;pending&gt;     80:30848/TCP   7s</span>
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="c"># Example if running locally with minikube</span>

  minikube service example-lb-service
  
  <span class="c"># |-----------|--------------------|-------------|-----------------------------|</span>
  <span class="c"># | NAMESPACE |        NAME        | TARGET PORT |             URL             |</span>
  <span class="c"># |-----------|--------------------|-------------|-----------------------------|</span>
  <span class="c"># | default   | example-lb-service |          80 | http://192.168.99.101:30848 |</span>
  <span class="c"># |-----------|--------------------|-------------|-----------------------------|</span>
  <span class="c"># ?  Opening service default/example-lb-service in default browser...</span>
</code></pre></div></div>

<h2 id="multi-container-app-example">Multi-Container App Example</h2>

<h3 id="architecture-1">Architecture</h3>

<p><img src="/assets/images/2021-12-18-kubernetes-basics/multi-container-app-arch.png" alt="Untitled"></p>

<ul>
  <li>Note that the ClusterIP works like a LoadBalancer and can point to a single pod or a set of pods, but it can only serve requests from within the cluster</li>
</ul>

<h3 id="directory-tree-1">Directory Tree</h3>

<ul>
  <li>app /
    <ul>
      <li>(app source code, including Dockerfile)</li>
    </ul>
  </li>
  <li>postgres /
    <ul>
      <li>(db Dockerfiles and init file)</li>
    </ul>
  </li>
  <li>k8s /
    <ul>
      <li>
        <p>app-deployment.yaml</p>

        <div class="language-yaml highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">apps/v1</span> <span class="c1"># based on docs</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Deployment</span>
<span class="na">metadata</span><span class="pi">:</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">app-deployment</span>
<span class="na">spec</span><span class="pi">:</span> <span class="c1"># controller specs</span>
    <span class="na">replicas</span><span class="pi">:</span> <span class="m">3</span>
    <span class="na">selector</span><span class="pi">:</span> 
    <span class="na">matchLabels</span><span class="pi">:</span>
    <span class="na">component</span><span class="pi">:</span> <span class="s">app</span> <span class="c1"># all pods with this label will be controlled</span>
    <span class="na">template</span><span class="pi">:</span> <span class="c1"># container specs and metadata</span>
    <span class="na">metadata</span><span class="pi">:</span>
    <span class="na">labels</span><span class="pi">:</span>
    <span class="na">component</span><span class="pi">:</span> <span class="s">app</span> <span class="c1"># all pods created will have this label</span>
    <span class="na">spec</span><span class="pi">:</span>
    <span class="na">containers</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">app</span>
        <span class="s">image</span><span class="err">:</span> <span class="s">app/latest</span>
        <span class="s">ports</span><span class="err">:</span>
        <span class="pi">-</span> <span class="na">containerPort</span><span class="pi">:</span> <span class="m">3000</span>
        <span class="na">env</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">DB_CONNECTION</span>
        <span class="na">value</span><span class="pi">:</span> <span class="s">pg</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">DB_HOST</span> <span class="c1"># use service name to reach db host</span>
                <span class="na">value</span><span class="pi">:</span> <span class="s">postgres-cluster-ip-service</span>
            <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">DB_PORT</span>
                <span class="s">value</span><span class="err">:</span> <span class="s1">'</span><span class="s">5432'</span>
            <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">DB_USER</span>
                <span class="s">value</span><span class="err">:</span> <span class="s">postgres</span>
            <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">DB_DATABASE</span> <span class="c1"># db to be used inside host</span>
                <span class="na">value</span><span class="pi">:</span> <span class="s">notesdb</span>
            <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">DB_PASSWORD</span>
                <span class="s">value</span><span class="err">:</span> <span class="s">63eaQB9wtLqmNBpg</span>
</code></pre></div>        </div>
      </li>
      <li>
        <p>postgres-deployment.yaml</p>

        <div class="language-yaml highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">apps/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Deployment</span>
<span class="na">metadata</span><span class="pi">:</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">postgres-deployment</span>
<span class="na">spec</span><span class="pi">:</span>
    <span class="na">replicas</span><span class="pi">:</span> <span class="m">1</span>
    <span class="na">selector</span><span class="pi">:</span>
    <span class="na">matchLabels</span><span class="pi">:</span>
        <span class="na">component</span><span class="pi">:</span> <span class="s">postgres</span>
    <span class="na">template</span><span class="pi">:</span>
    <span class="na">metadata</span><span class="pi">:</span>
        <span class="na">labels</span><span class="pi">:</span>
        <span class="na">component</span><span class="pi">:</span> <span class="s">postgres</span>
    <span class="na">spec</span><span class="pi">:</span>
    <span class="na">volumes</span><span class="pi">:</span> <span class="c1"># pods' storage assignments and claims</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">postgres-storage</span>
            <span class="s">persistentVolumeClaim</span><span class="err">:</span>
            <span class="na">claimName</span><span class="pi">:</span> <span class="s">database-persistent-volume-claim</span>
        <span class="na">containers</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">postgres</span>
            <span class="s">image</span><span class="err">:</span> <span class="s">postgres/latest</span>
            <span class="s">ports</span><span class="err">:</span>
            <span class="pi">-</span> <span class="na">containerPort</span><span class="pi">:</span> <span class="m">5432</span>
        <span class="na">volumeMounts</span><span class="pi">:</span> <span class="c1"># connect pod volumes to container</span>
            <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">postgres-storage</span>
                <span class="s">mountPath</span><span class="err">:</span> <span class="s">/var/lib/postgresql/data</span> <span class="c1"># container dir</span>
                <span class="na">subPath</span><span class="pi">:</span> <span class="s">postgres</span> <span class="c1"># dir created inside vol for container</span>
            <span class="na">env</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">POSTGRES_PASSWORD</span> <span class="c1"># used to connect to db via API</span>
                <span class="na">value</span><span class="pi">:</span> <span class="s">63eaQB9wtLqmNBpg</span>
            <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">POSTGRES_DB</span>
                <span class="s">value</span><span class="err">:</span> <span class="s">appdb</span>
</code></pre></div>        </div>
      </li>
      <li>
        <p>database-persistent-volume.yaml</p>

        <div class="language-yaml highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="c1"># Not actually used, just an example</span>

<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">PersistentVolume</span>
<span class="na">metadata</span><span class="pi">:</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">database-persistent-volume</span>
<span class="na">spec</span><span class="pi">:</span>
    <span class="na">storageClassName</span><span class="pi">:</span> <span class="s">manual</span>
    <span class="na">capacity</span><span class="pi">:</span>
    <span class="na">storage</span><span class="pi">:</span> <span class="s">5Gi</span>
    <span class="na">accessModes</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">ReadWriteOnce</span> <span class="c1"># mounted as r/w by one single node</span>
    <span class="c1"># - ReadOnlyMany # many nodes can mount it as read only</span>
    <span class="na">hostPath</span><span class="pi">:</span> <span class="c1"># development-specific, look into carefully on creation</span>
    <span class="na">path</span><span class="pi">:</span> <span class="s2">"</span><span class="s">/mnt/data"</span>
</code></pre></div>        </div>
      </li>
      <li>
        <p>database-persistent-volume-claim.yaml</p>

        <div class="language-yaml highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">PersistentVolumeClaim</span>
<span class="na">metadata</span><span class="pi">:</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">database-persistent-volume-claim</span>
<span class="na">spec</span><span class="pi">:</span>
    <span class="c1">#storageClassName: manual # removing this dynamically creates volume</span>
    <span class="na">accessModes</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">ReadWriteOnce</span>
    <span class="na">resources</span><span class="pi">:</span>
    <span class="na">requests</span><span class="pi">:</span>
        <span class="na">storage</span><span class="pi">:</span> <span class="s">2Gi</span>
</code></pre></div>        </div>
      </li>
      <li>
        <p>postgres-cluster-ip-service.yaml</p>

        <div class="language-yaml highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Service</span>
<span class="na">metadata</span><span class="pi">:</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">postgres-cluster-ip-service</span>
<span class="na">spec</span><span class="pi">:</span>
    <span class="na">type</span><span class="pi">:</span> <span class="s">ClusterIP</span>
    <span class="na">selector</span><span class="pi">:</span>
    <span class="na">component</span><span class="pi">:</span> <span class="s">postgres</span>
    <span class="na">ports</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">port</span><span class="pi">:</span> <span class="m">5432</span>
        <span class="na">targetPort</span><span class="pi">:</span> <span class="m">5432</span>
</code></pre></div>        </div>
      </li>
      <li>
        <p>app-lb-service.yaml</p>

        <div class="language-yaml highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Service</span>
<span class="na">metadata</span><span class="pi">:</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">app-lb-service</span>
<span class="na">spec</span><span class="pi">:</span>
    <span class="na">type</span><span class="pi">:</span> <span class="s">LoadBalancer</span>
    <span class="na">ports</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">port</span><span class="pi">:</span> <span class="m">3000</span>
        <span class="na">targetPort</span><span class="pi">:</span> <span class="m">3000</span>
    <span class="na">selector</span><span class="pi">:</span>
    <span class="na">component</span><span class="pi">:</span> <span class="s">app</span>
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
  <li>
    <p>docker-compose.yaml</p>

    <div class="language-yaml highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="na">version</span><span class="pi">:</span> <span class="s2">"</span><span class="s">3.8"</span>
  
<span class="na">services</span><span class="pi">:</span> 
    <span class="na">db</span><span class="pi">:</span>
        <span class="na">build</span><span class="pi">:</span>
            <span class="c1"># custom image w/ app table pre-created</span>
            <span class="na">context</span><span class="pi">:</span> <span class="s">./postgres</span>
            <span class="na">dockerfile</span><span class="pi">:</span> <span class="s">Dockerfile.dev</span>
        <span class="na">volumes</span><span class="pi">:</span> 
            <span class="pi">-</span> <span class="s">db-data:/var/lib/postgresql/data</span>
        <span class="na">environment</span><span class="pi">:</span>
            <span class="na">POSTGRES_PASSWORD</span><span class="pi">:</span> <span class="s">63eaQB9wtLqmNBpg</span>
            <span class="na">POSTGRES_DB</span><span class="pi">:</span> <span class="s">notesdb</span>
    <span class="na">app</span><span class="pi">:</span>
        <span class="na">build</span><span class="pi">:</span> 
            <span class="na">context</span><span class="pi">:</span> <span class="s">./app</span>
            <span class="na">dockerfile</span><span class="pi">:</span> <span class="s">Dockerfile.dev</span>
        <span class="na">ports</span><span class="pi">:</span> 
            <span class="pi">-</span> <span class="s">3000:3000</span>
        <span class="na">volumes</span><span class="pi">:</span> 
            <span class="pi">-</span> <span class="s">/home/node/app/node_modules</span>
            <span class="pi">-</span> <span class="s">./app:/home/node/app</span>
        <span class="na">environment</span><span class="pi">:</span> 
            <span class="na">DB_CONNECTION</span><span class="pi">:</span> <span class="s">pg</span>
            <span class="na">DB_HOST</span><span class="pi">:</span> <span class="s">db</span>
            <span class="na">DB_PORT</span><span class="pi">:</span> <span class="m">5432</span>
            <span class="na">DB_USER</span><span class="pi">:</span> <span class="s">postgres</span>
            <span class="na">DB_DATABASE</span><span class="pi">:</span> <span class="s">notesdb</span>
            <span class="na">DB_PASSWORD</span><span class="pi">:</span> <span class="s">63eaQB9wtLqmNBpg</span>
  
<span class="na">volumes</span><span class="pi">:</span>
    <span class="na">db-data</span><span class="pi">:</span>
        <span class="na">name</span><span class="pi">:</span> <span class="s">app-db-dev-data</span>
</code></pre></div>    </div>
  </li>
</ul>

<h3 id="execution-1">Execution</h3>

<ul>
  <li>
    <p>Debug session example:</p>

    <div class="language-bash highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>kubectl apply <span class="nt">-f</span> app-deployment.yaml
  
<span class="c"># deployment.apps/app-deployment created</span>
  
kubectl get deployment
  
<span class="c"># NAME             READY   UP-TO-DATE   AVAILABLE   AGE</span>
<span class="c"># app-deployment   0/3     3            0           18m2s</span>
  
kubectl get <span class="nt">-f</span> app-deployment.yaml
  
<span class="c"># NAME             READY   UP-TO-DATE   AVAILABLE   AGE   CONTAINERS   IMAGES               SELECTOR</span>
<span class="c"># app-deployment   0/3     3            0           19m   app          app/latest           component=app</span>
  
kubectl get pod
  
<span class="c"># NAME                             READY   STATUS             RESTARTS   AGE</span>
<span class="c"># app-deployment-d59f9c884-88j45   0/1     CrashLoopBackOff   10         30m</span>
<span class="c"># app-deployment-d59f9c884-96hfr   0/1     CrashLoopBackOff   10         30m</span>
<span class="c"># app-deployment-d59f9c884-pzdxg   0/1     CrashLoopBackOff   10         30m</span>
  
kubectl describe pod api-deployment-d59f9c884-88j45
  
<span class="c"># (Extensive debug info)</span>
  
kubectl logs api-deployment-d59f9c884-88j45
  
<span class="c"># (Logs for container -- error with image)</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>After fixing image:</p>

    <div class="language-bash highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>kubectl apply <span class="nt">-f</span> api-deployment.yaml
  
<span class="c"># deployment.apps/api-deployment configured</span>
  
kubectl get deployment
  
<span class="c"># NAME             READY   UP-TO-DATE   AVAILABLE   AGE</span>
<span class="c"># app-deployment   3/3     3            3           6m</span>
  
kubectl get pod
  
<span class="c"># NAME                              READY   STATUS    RESTARTS   AGE</span>
<span class="c"># app-deployment-66cdd98546-l9x8q   1/1     Running   0          7m26s</span>
<span class="c"># app-deployment-66cdd98546-mbfw9   1/1     Running   0          7m31s</span>
<span class="c"># app-deployment-66cdd98546-pntxv   1/1     Running   0          7m21s</span>
  
kubectl apply <span class="nt">-f</span> postgres-deployment.yaml
  
<span class="c"># deployment.apps/postgres-deployment created</span>
  
kubectl get deployment
  
<span class="c"># NAME                  READY   UP-TO-DATE   AVAILABLE   AGE</span>
<span class="c"># postgres-deployment   1/1     1            1           13m</span>
  
kubectl get pod
  
<span class="c"># NAME                                   READY   STATUS    RESTARTS   AGE</span>
<span class="c"># postgres-deployment-76fcc75998-mwnb7   1/1     Running   0          13m</span>
  
kubectl apply <span class="nt">-f</span> database-persistent-volume-claim.yaml
  
<span class="c"># persistentvolumeclaim/database-persistent-volume-claim created</span>
  
kubectl get persistentvolumeclaim
  
<span class="c"># NAME                               STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS   AGE</span>
<span class="c"># database-persistent-volume-claim   Bound    pvc-525ae8af-00d3-4cc7-ae47-866aa13dffd5   2Gi        RWO            standard       2s</span>
  
kubectl apply <span class="nt">-f</span> postgres-cluster-ip-service.yaml
kubectl apply <span class="nt">-f</span> app-lb-service.yaml
</code></pre></div>    </div>
  </li>
  <li>
    <p>Short version:</p>

    <div class="language-yaml highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="s">kubectl apply -f k8s</span>
  
<span class="c1"># deployment.apps/app-deployment created</span>
<span class="c1"># service/app-load-balancer-service created</span>
<span class="c1"># persistentvolumeclaim/database-persistent-volume-claim created</span>
<span class="c1"># service/postgres-cluster-ip-service created</span>
<span class="c1"># deployment.apps/postgres-deployment created</span>
  
<span class="s">kubectl get deployment</span>
  
<span class="c1"># NAME                  READY   UP-TO-DATE   AVAILABLE   AGE</span>
<span class="c1"># app-deployment        3/3     3            3           106s</span>
<span class="c1"># postgres-deployment   1/1     1            1           106s</span>
</code></pre></div>    </div>
  </li>
</ul>

<h2 id="further-education">Further Education</h2>

<ul>
  <li>
<a href="https://kubernetes.io/docs/home/">Kubernetes Documentation</a>: go through “Getting Started”, “Tutorials”, “Concepts”.</li>
  <li>
<a href="https://kubernetes.io/docs/tasks/">Task Catalog</a>: How to do common Kubernetes tasks.</li>
  <li>
<a href="https://kubernetes.io/docs/reference/">Reference page</a> - all things API, setup (kubeadm) and component (kubelet, kube-proxy, TLS bootstrapping, etc) tools, kubectl, etc.</li>
</ul>


    </div>

</article>
<div class="post-nav">
<a class="previous" href="/terraform-terragrunt-basics/" title="Terraform + Terragrunt Basics">Terraform + Terragrunt Basics</a><a class="next" href="/reinvent-2019-data-driven-cloud-native-ecosystem/" title="AWS re:Invent 2019: Data-Driven, Cloud-Native Ecosystem">AWS re:Invent 2019: Data-Driven, Cloud-Native Ecosystem...</a>
</div>
<div class="post-related">
      <div>Related Articles</div>
      <ul>
        <li><a class="post-link" href="/aws-developer-associate-notes/" title="AWS re:Invent 2019: Data-Driven, Cloud-Native Ecosystem">AWS Developer Associate Certification Notes</a></li>
<li><a class="post-link" href="/azure-app-services-architecture/" title="AWS re:Invent 2019: Data-Driven, Cloud-Native Ecosystem">Azure App Service Architecture</a></li>
<li><a class="post-link" href="/terraform-terragrunt-basics/" title="AWS re:Invent 2019: Data-Driven, Cloud-Native Ecosystem">Terraform + Terragrunt Basics</a></li>
<li><a class="post-link" href="/kubernetes-basics/" title="AWS re:Invent 2019: Data-Driven, Cloud-Native Ecosystem">Kubernetes Basics</a></li>
</ul>
    </div>
<div class="post-comments"></div></section>
</div>


  </section>
  <section class="sidebar" style="margin-left: 15px;">
    <!-- Get sidebar items --><style type="text/css" media="screen">
.post-menu ul {
  list-style: none;
  padding: 0;
  margin: 0;
}
</style>

<div class="post-menu">
  <div class="post-menu-title">TOC</div>
  <div class="post-menu-content"></div>
</div>

<script>
  function generateContent() {
    var menu = document.querySelector(".post-menu");
    var menuContent =  menu.querySelector(".post-menu-content");
    var headings = document.querySelector(".post-content").querySelectorAll("h2, h3, h4, h5, h6");

    // Hide menu when no headings
    if (headings.length === 0) {
      return menu.style.display = "none";
    }

    // Generate post menu
    var menuHTML = '';
    for (var i = 0; i < headings.length; i++) {
      var h = headings[i];
      menuHTML += (
        '<li class="h-' + h.tagName.toLowerCase() + '">'
        + '<a href="#h-' + h.getAttribute('id') + '">' + h.textContent + '</a></li>');
    }

    menuContent.innerHTML = '<ul>' + menuHTML + '</ul>';

    // The header element
    var header = document.querySelector('header.site-header');

    function doMenuCollapse(index, over_items) {
      var items = menuContent.firstChild.children;

      if (over_items == undefined) {
        over_items = 20;
      }

      if (items.length < over_items) {
        return;
      }

      var activeItem = items[index];
      var beginItem = activeItem
      var endItem = activeItem
      var beginIndex = index;
      var endIndex = index + 1;
      while (beginIndex >= 0
        && !items[beginIndex].classList.contains('h-h2')) {
        beginIndex -= 1;
      }
      while (endIndex < items.length
        && !items[endIndex].classList.contains('h-h2')) {
        endIndex += 1;
      }
      for (var i = 0; i < beginIndex; i++) {
        item = items[i]
        if (!item.classList.contains('h-h2')) {
          item.style.display = 'none';
        }
      }
      for (var i = beginIndex + 1; i < endIndex; i++) {
        item = items[i]
        // if (!item.classList.contains('h-h2')) {
          item.style.display = '';
        // }
      }
      for (var i = endIndex; i < items.length; i++) {
        item = items[i]
        if (!item.classList.contains('h-h2')) {
          item.style.display = 'none';
        }
      }
    }

    // Init menu collapsed
    doMenuCollapse(-1);

    // Active the menu item
    window.addEventListener('scroll', function (event) {
      var lastActive = menuContent.querySelector('.active');
      var changed = true;
      var activeIndex = -1;
      for (var i = headings.length - 1; i >= 0; i--) {
        var h = headings[i];
        var headingRect = h.getBoundingClientRect();
        var headerRect = header.getBoundingClientRect();
        var headerTop = Math.floor(headerRect.top);
        var headerHeight = Math.floor(headerRect.height);
        var headerHeight = headerTop + headerHeight + 20;
        if (headingRect.top <= headerHeight) {
          var id = 'h-' + h.getAttribute('id');
          var a = menuContent.querySelector('a[href="#' + id  + '"]');
          var curActive = a.parentNode;
          if (curActive) {
            curActive.classList.add('active');
            activeIndex = i;
          }
          if (lastActive == curActive) {
            changed = false;
          }
          break;
        }
      }
      if (changed) {
        if (lastActive) {
          lastActive.classList.remove('active');
        }
        doMenuCollapse(activeIndex);
      }
      event.preventDefault();
    });
  }
  generateContent();
</script>
</section>
</div>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">
    <div class="site-footer-inner">
<div>
<span class="copyleft">©</span> 2021-2022 Lucas Sousa</div>
      <div>Powered by <a title="Jekyll is a simple, blog-aware, static site
      generator." href="http://jekyllrb.com/">Jekyll</a> &amp; <a title="Yat, yet
      another theme." href="https://github.com/jeffreytse/jekyll-theme-yat">Yat Theme</a>.</div>
      <div class="footer-col rss-subscribe">Subscribe <a href="/feed.xml">via RSS</a>
</div>
    </div>
  </div>
</footer>
</body>
</html>
